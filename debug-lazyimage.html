<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LazyImage Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .test-container {
            margin: 20px 0;
            border: 2px solid #ccc;
            padding: 20px;
        }
        .image-container {
            width: 100%;
            height: 400px;
            position: relative;
            border: 1px solid #999;
        }
        .debug-info {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>LazyImage Component Debug</h1>

    <div class="test-container">
        <h2>Test 1: Direct Image Load</h2>
        <div class="debug-info">Testing direct image load without lazy loading</div>
        <div class="image-container">
            <img 
                src="/assets/05_traditional_heritage-1536w.webp"
                srcset="/assets/05_traditional_heritage-640w.webp 640w,
                        /assets/05_traditional_heritage-768w.webp 768w,
                        /assets/05_traditional_heritage-1024w.webp 1024w,
                        /assets/05_traditional_heritage-1536w.webp 1536w"
                sizes="100vw"
                alt="Traditional Japanese raisin tree harvesting"
                style="width: 100%; height: 100%; object-fit: cover; filter: brightness(0.85);"
                onload="document.getElementById('direct-status').innerHTML = 'Image loaded successfully'"
                onerror="document.getElementById('direct-status').innerHTML = 'Image failed to load: ' + this.src"
            />
        </div>
        <div id="direct-status" class="debug-info">Waiting for image...</div>
    </div>

    <div class="test-container">
        <h2>Test 2: Check Image URLs</h2>
        <div class="debug-info">Testing each image size individually</div>
        <div id="url-tests"></div>
    </div>

    <div class="test-container">
        <h2>Test 3: Intersection Observer Debug</h2>
        <div class="debug-info">Testing intersection observer behavior</div>
        <div class="image-container" id="observer-test" style="background-color: #f3f4f6;">
            <div id="observer-status">Checking intersection...</div>
        </div>
    </div>

    <script>
        // Test 2: Check individual URLs
        const imageUrls = [
            '/assets/05_traditional_heritage-640w.webp',
            '/assets/05_traditional_heritage-768w.webp',
            '/assets/05_traditional_heritage-1024w.webp',
            '/assets/05_traditional_heritage-1536w.webp'
        ];

        const urlTestContainer = document.getElementById('url-tests');
        
        imageUrls.forEach((url, index) => {
            const testDiv = document.createElement('div');
            testDiv.className = 'debug-info';
            testDiv.innerHTML = `Testing ${url}: <span id="test-${index}">Loading...</span>`;
            urlTestContainer.appendChild(testDiv);

            const img = new Image();
            img.onload = () => {
                document.getElementById(`test-${index}`).innerHTML = `✅ Success (${img.width}x${img.height})`;
                document.getElementById(`test-${index}`).style.color = 'green';
            };
            img.onerror = () => {
                document.getElementById(`test-${index}`).innerHTML = '❌ Failed to load';
                document.getElementById(`test-${index}`).style.color = 'red';
            };
            img.src = url;
        });

        // Test 3: Intersection Observer
        const observerTestElement = document.getElementById('observer-test');
        const observerStatus = document.getElementById('observer-status');

        const observer = new IntersectionObserver(
            ([entry]) => {
                observerStatus.innerHTML = `
                    <strong>Intersection Observer Result:</strong><br/>
                    isIntersecting: ${entry.isIntersecting}<br/>
                    intersectionRatio: ${entry.intersectionRatio}<br/>
                    boundingClientRect: ${JSON.stringify(entry.boundingClientRect)}<br/>
                    rootBounds: ${JSON.stringify(entry.rootBounds)}
                `;
                
                if (entry.isIntersecting) {
                    observerStatus.style.color = 'green';
                    observer.unobserve(entry.target);
                    
                    // Now try to load the image
                    const img = document.createElement('img');
                    img.src = '/assets/05_traditional_heritage-1536w.webp';
                    img.style.cssText = 'width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.3s;';
                    img.onload = () => {
                        img.style.opacity = '1';
                        observerTestElement.style.backgroundColor = 'transparent';
                    };
                    img.onerror = () => {
                        observerStatus.innerHTML += '<br/>❌ Image failed to load after intersection';
                    };
                    observerTestElement.appendChild(img);
                }
            },
            { threshold: 0.1, rootMargin: '100px' }
        );

        if (observerTestElement) {
            observer.observe(observerTestElement);
        }

        // Console debugging
        console.log('Debug page loaded');
        console.log('Current location:', window.location);
        console.log('Base URL:', window.location.origin);
    </script>
</body>
</html>